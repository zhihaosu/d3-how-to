<!DOCTYPE html>
<html>

<head>
  <title>D3.js Starter Kits</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="vendor/highlight/styles/monokai.css"/>
  <script src="js/jquery.js"></script>
  <script src="js/d3.v4.js"></script>
  <script src="vendor/highlight/highlight.pack.js"></script>
  <script src="js/boot.js"></script>
  <link rel="stylesheet" href="css/main.css"/>
</head>

<style>
  rect {
    fill: cadetblue;
    opacity: 0.3;
    stroke: white;
  }

  text {
    font-family: "Helvetica Neue", Helvetica, sans-serif;
    /*fill: white;*/
    font-size: 14px;
  }
</style>

<body>

<svg width="420" height="220">
  <g></g>
</svg>

<script>
  var data = {
    'name': 'A1',
    'children': [{
      'name': 'B1',
      'children': [{
        'name': 'C1',
        'value': 100
      },
        {
          'name': 'C2',
          'value': 300
        },
        {
          'name': 'C3',
          'value': 200
        }
      ],
      value: 100 // 该部分是额外加的
    },
      {
        'name': 'B2',
        'value': 200
      }
    ]
  }

  // 原始hierarchy数据
  console.log('原始hierarchy数据')
  var root2 = d3.hierarchy(data)
  console.log(root2)

  var root = d3.hierarchy(data)
  var treemapLayout = d3.treemap()
    .size([400, 200])
    .paddingOuter(16)

  root.sum(function (d) {
    return d.value
  })

  treemapLayout(root)
  // treemap结构数据，增加x0,y0, x1,y1
  console.log('treemap结构数据，增加x0,y0, x1,y1')
  console.log(root)

  var nodes = d3.select('svg g')
    .selectAll('g')
    .data(root.descendants())
    .enter()
    .append('g')
    .attr('transform', function (d) {
      return 'translate(' + [d.x0, d.y0] + ')'
    })

  nodes
    .append('rect')
    .attr('width', function (d) {
      return d.x1 - d.x0
    })
    .attr('height', function (d) {
      return d.y1 - d.y0
    })

  nodes
    .append('text')
    .attr('dx', 4)
    .attr('dy', 14)
    .text(function (d) {
      return d.data.name
    })
</script>
</body>

</html>
